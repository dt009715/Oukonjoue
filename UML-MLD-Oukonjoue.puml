@startuml
hide circle
skinparam linetype ortho
skinparam entityAttributeIconSize 0

' =========================
' ========== TABLES =======
' =========================

entity "role" as Role {
  *id_role : int <<PK>>
  --
  nom_role : varchar  ' ARTISTE | INSTITUTION | ADMIN ...
}

entity "departement" as Dept {
  *id_dept : int <<PK>>
  --
  nom : varchar
  numero : varchar
}

entity "categorie" as Cat {
  *id_cate : int <<PK>>
  --
  nom_cate : varchar
}

entity "utilisateur" as U {
  *id_user : int <<PK>>
  --
  name : varchar
  mail : varchar
  image : varchar
  tel : varchar
  description : text
  link : varchar
  password : varchar
  --
  role_id : int <<FK>>
  dept_id : int <<FK>>
  cate_id : int <<FK>>
}

' Profil optionnel si le user est une INSTITUTION (salle/bar/festival)
entity "institution_profile" as InstP {
  *user_id : int <<PK,FK>>
  --
  material : text
  address : varchar
}

' Profil optionnel si le user est un ARTISTE / GROUPE (si tu veux séparer des champs dédiés)
entity "artist_profile" as ArtP {
  *user_id : int <<PK,FK>>
  --
  ' champs spécifiques si besoin (ex: style, members, rider...)
  spotify : varchar
  linktree : varchar
}

entity "commentary" as Com {
  *id_comment : int <<PK>>
  --
  content : text
  creation_date : datetime
  --
  author_user_id : int <<FK>>
  target_institution_user_id : int <<FK>>
}

' =========================
' ====== MESSAGERIE =======
' =========================

entity "conversation" as Conv {
  *id_conv : int <<PK>>
  --
  created_at : datetime
  user_a_id : int <<FK>>
  user_b_id : int <<FK>>
}

entity "message" as Msg {
  *id_msg : int <<PK>>
  --
  texte : text
  heure : datetime
  --
  sender_user_id : int <<FK>>
  conv_id : int <<FK>>
}

' =========================
' ===== RELATIONS (FK) =====
' =========================

Role ||--o{ U : "role"
Dept ||--o{ U : "localise"
Cat  ||--o{ U : "categorie"

' Profils 1-1 optionnels (0..1)
U ||--o| InstP : "profil institution"
U ||--o| ArtP  : "profil artiste"

' Commentaires: un user écrit, un user (institution) reçoit
U ||--o{ Com : "ecrit"
U ||--o{ Com : "recoit (institution)"

' Conversations: 2 participants (même table utilisateur)
U ||--o{ Conv : "participant A"
U ||--o{ Conv : "participant B"

' Messages: appartiennent à une conversation, envoyés par un user
Conv ||--o{ Msg : "contient"
U    ||--o{ Msg : "envoie"

@enduml
